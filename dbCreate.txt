DROP DATABASE if exists SAT;
CREATE DATABASE SAT;
USE SAT;

-- CREATE TABLES
CREATE TABLE users (
    id INT AUTO_INCREMENT PRIMARY KEY,
    password VARCHAR(255),
    email VARCHAR(255) UNIQUE,
    name VARCHAR(255),
    isAdmin BOOLEAN,
    created DATETIME,
    updated DATETIME,
    deleted DATETIME NULL
);

CREATE TABLE templates (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(255) UNIQUE,
    defaultValue DECIMAL(10, 2),
    defaultDepreciation DECIMAL(10, 2),
    icon VARCHAR(255),
    singleResident BOOLEAN,
    created DATETIME,
    updated DATETIME,
    deleted DATETIME NULL
);

CREATE TABLE facilities (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(255) UNIQUE,
    address VARCHAR(255) UNIQUE,
    manager VARCHAR(255),
    phone VARCHAR(20),
    email VARCHAR(255),
    created DATETIME,
    updated DATETIME,
    deleted DATETIME NULL
);

CREATE TABLE units (
    id INT AUTO_INCREMENT PRIMARY KEY,
    facilityId INT,
    name VARCHAR(255) UNIQUE,
    type VARCHAR(255),
    created DATETIME,
    updated DATETIME,
    deleted DATETIME NULL,
    FOREIGN KEY (facilityId) REFERENCES facilities(id)
);

CREATE TABLE facilityAuths (
    userId INT,
    facilityId INT,
    added DATETIME,
    revoked DATETIME NULL,
    authorizedBy INT,
    FOREIGN KEY (userId) REFERENCES users(id),
    FOREIGN KEY (facilityId) REFERENCES facilities(id),
    FOREIGN KEY (authorizedBy) REFERENCES users(id)
);

CREATE TABLE items (
    id INT AUTO_INCREMENT PRIMARY KEY,
    unitId INT,
    templateId INT,
    donated BOOLEAN,
    initialValue DECIMAL(10, 2),
    depreciationRate DECIMAL(10, 2),
    toInspect BOOLEAN,
    addedBy INT,
    lastInspected DATETIME NULL,
    inspectedBy INT NULL,
    created DATETIME,
    updated DATETIME,
    deleted DATETIME NULL,
    comment VARCHAR(255),
    FOREIGN KEY (unitId) REFERENCES units(id),
    FOREIGN KEY (templateId) REFERENCES templates(id),
    FOREIGN KEY (addedBy) REFERENCES users(id),
    FOREIGN KEY (inspectedBy) REFERENCES users(id)
);